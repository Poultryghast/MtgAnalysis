
CREATE VIEW clusters_view AS 
SELECT c.id,
c.frequency,
c.mainboard,
c.sideboard, 
(
	SELECT array
	(
		SELECT h.card FROM highlightcards h WHERE h.cluster = c.id ORDER BY h.frequency DESC LIMIT 5
	)
) as highlights,
(
	SELECT array
	(
		SELECT s.clustera FROM similarclusters s WHERE s.clusterb = c.id UNION SELECT s.clusterb FROM similarclusters s WHERE s.clustera = c.id
	)
) as similar
FROM clusters c ORDER BY c.frequency DESC;